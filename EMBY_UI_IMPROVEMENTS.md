# Emby åª’ä½“æœåŠ¡å™¨ UI æ”¹è¿›è¯´æ˜

## æ”¹è¿›å†…å®¹

### 1. æ·»åŠ å½±ç‰‡å›¾ç‰‡å±•ç¤ºåŠŸèƒ½

#### é—®é¢˜
- ä¹‹å‰åªä½¿ç”¨ emoji å›¾æ ‡ï¼ˆğŸ“ã€ğŸ¬ã€ğŸ“ºï¼‰ä½œä¸ºå ä½ç¬¦
- æ²¡æœ‰åŠ è½½å’Œæ˜¾ç¤ºå®é™…çš„ Emby å›¾ç‰‡

#### è§£å†³æ–¹æ¡ˆ
- æ·»åŠ äº†å›¾ç‰‡ç¼“å­˜ç³»ç»Ÿ `emby_image_cache: HashMap<String, TextureHandle>`
- æ·»åŠ äº†å›¾ç‰‡åŠ è½½çŠ¶æ€è¿½è¸ª `emby_image_loading: HashSet<String>`
- å®ç°äº† `load_emby_image()` å‡½æ•°ï¼Œæ”¯æŒåŠ è½½æµ·æŠ¥ï¼ˆPrimaryï¼‰å’ŒèƒŒæ™¯å›¾ï¼ˆBackdropï¼‰
- åœ¨å¡ç‰‡æ¸²æŸ“æ—¶è‡ªåŠ¨è§¦å‘å›¾ç‰‡åŠ è½½
- ä½¿ç”¨ `EmbyClient::get_image_url()` è·å–æ­£ç¡®çš„å›¾ç‰‡ URL

#### å®ç°ç»†èŠ‚
```rust
// å›¾ç‰‡ç¼“å­˜é”®æ ¼å¼: "{item_id}_{image_type}"
let image_key = format!("{}_{}", item.id, "Primary");

// æ£€æŸ¥ç¼“å­˜å¹¶æ˜¾ç¤º
if let Some(texture) = self.emby_image_cache.get(&image_key) {
    // æ˜¾ç¤ºå›¾ç‰‡
} else {
    // æ˜¾ç¤ºå ä½ç¬¦å¹¶è§¦å‘åŠ è½½
    if !self.emby_image_loading.contains(&image_key) {
        self.load_emby_image(item, false);
    }
}
```

### 2. æ”¹è¿›å±•ç¤ºæ•ˆæœ - æ¯ä¸ªç›®å½•ä¸€è¡Œå±•ç¤º

#### é—®é¢˜
- Dashboard ä¸­æ‰€æœ‰ç›®å½•æ··åœ¨ä¸€èµ·å±•ç¤º
- æ²¡æœ‰"æ›´å¤š"æŒ‰é’®
- æ— æ³•å¿«é€Ÿæµè§ˆä¸åŒç›®å½•çš„å†…å®¹

#### è§£å†³æ–¹æ¡ˆ
- é‡æ„ `show_emby_dashboard()` å‡½æ•°
- æ¯ä¸ªåª’ä½“åº“ï¼ˆViewï¼‰ç‹¬å ä¸€è¡Œ
- æ¯è¡Œæ˜¾ç¤ºï¼š
  - ç›®å½•æ ‡é¢˜ï¼ˆå¤§å·å­—ä½“ï¼‰
  - æ¨ªå‘æ»šåŠ¨çš„é¡¹ç›®é¢„è§ˆï¼ˆå‰ 6 é¡¹ï¼‰
  - "æ›´å¤š â†’" æŒ‰é’®ï¼ˆå³ä¸Šè§’ï¼‰
- ç‚¹å‡»"æ›´å¤š"è¿›å…¥è¯¥ç›®å½•çš„å®Œæ•´æµè§ˆé¡µé¢

#### ä»£ç ç»“æ„
```rust
for view in &dash.views {
    // æ ‡é¢˜è¡Œ
    ui.horizontal(|ui| {
        ui.heading(&view.name);
        if subtle_button(ui, "æ›´å¤š â†’").clicked() {
            // è¿›å…¥å®Œæ•´æµè§ˆ
        }
    });
    
    // æ¨ªå‘æ»šåŠ¨çš„é¡¹ç›®é¢„è§ˆ
    self.render_horizontal_item_row(ui, &view.id, 6);
}
```

### 3. æ·»åŠ åˆ†é¡µåŠŸèƒ½

#### é—®é¢˜
- æµè§ˆå™¨è§†å›¾ä¸€æ¬¡æ€§æ˜¾ç¤ºæ‰€æœ‰é¡¹ç›®
- å¤§é‡é¡¹ç›®æ—¶æ€§èƒ½å·®ï¼Œæ»šåŠ¨ä¸ä¾¿

#### è§£å†³æ–¹æ¡ˆ
- æ·»åŠ åˆ†é¡µçŠ¶æ€å˜é‡ï¼š
  - `emby_items_per_page: usize` - æ¯é¡µæ˜¾ç¤ºæ•°é‡ï¼ˆé»˜è®¤ 20ï¼‰
  - `emby_current_page: usize` - å½“å‰é¡µç 
- å®ç°åˆ†é¡µæ§åˆ¶æ ï¼š
  - æ˜¾ç¤ºæ€»é¡¹ç›®æ•°å’Œå½“å‰é¡µç 
  - æä¾›"é¦–é¡µ"ã€"ä¸Šä¸€é¡µ"ã€"ä¸‹ä¸€é¡µ"ã€"æœ«é¡µ"æŒ‰é’®
- åªæ¸²æŸ“å½“å‰é¡µçš„é¡¹ç›®ï¼Œæå‡æ€§èƒ½

#### åˆ†é¡µé€»è¾‘
```rust
let total_items = self.emby_items.len();
let total_pages = (total_items + self.emby_items_per_page - 1) / self.emby_items_per_page;
let start_idx = self.emby_current_page * self.emby_items_per_page;
let end_idx = (start_idx + self.emby_items_per_page).min(total_items);

// åªæ˜¾ç¤ºå½“å‰é¡µ
let page_items = &self.emby_items[start_idx..end_idx];
```

### 4. å®Œå–„å½±ç‰‡è¯¦æƒ…é¡µé¢

#### é—®é¢˜
- è¯¦æƒ…é¡µä¿¡æ¯ä¸å…¨
- æ²¡æœ‰æµ·æŠ¥å›¾å’ŒèƒŒæ™¯å›¾
- ç¼ºå°‘å®Œæ•´çš„å…ƒæ•°æ®å±•ç¤º

#### è§£å†³æ–¹æ¡ˆ
- æ·»åŠ èƒŒæ™¯å›¾ï¼ˆBackdropï¼‰å±•ç¤º
  - å…¨å®½èƒŒæ™¯å›¾
  - åº•éƒ¨æ¸å˜é®ç½©æ•ˆæœ
- æ·»åŠ æµ·æŠ¥å›¾ï¼ˆPosterï¼‰å±•ç¤º
  - å·¦ä¾§ç‹¬ç«‹æ˜¾ç¤º
  - 180x270 å°ºå¯¸
- å®Œå–„å…ƒæ•°æ®å±•ç¤ºï¼š
  - æ ‡é¢˜ï¼ˆå¤§å·å­—ä½“ï¼‰
  - å¹´ä»½ã€åˆ†çº§ã€æ—¶é•¿
  - è¯„åˆ†ï¼ˆæ˜Ÿçº§æ˜¾ç¤ºï¼‰
  - ç±»å‹æ ‡ç­¾
  - åŸå§‹æ ‡é¢˜
  - é›†æ•°/å­£æ•°ï¼ˆå‰§é›†ï¼‰
  - è¯¦ç»†ç®€ä»‹
- æ”¹è¿›æ’­æ”¾æŒ‰é’®æ ·å¼
  - æ›´å¤§å°ºå¯¸ï¼ˆ160x50ï¼‰
  - é†’ç›®çš„è“è‰²èƒŒæ™¯
  - åœ†è§’è®¾è®¡

#### è¯¦æƒ…é¡µå¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     èƒŒæ™¯å›¾ï¼ˆBackdropï¼‰               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”                             â”‚
â”‚  â”‚æµ·æŠ¥â”‚  æ ‡é¢˜                        â”‚
â”‚  â”‚å›¾  â”‚  å¹´ä»½ â€¢ åˆ†çº§ â€¢ æ—¶é•¿          â”‚
â”‚  â”‚    â”‚  â˜… è¯„åˆ†                     â”‚
â”‚  â””â”€â”€â”€â”€â”˜  [â–¶ ç«‹å³æ’­æ”¾]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ç®€ä»‹
  è¯¦ç»†ä¿¡æ¯ï¼ˆç½‘æ ¼å¸ƒå±€ï¼‰
```

### 5. ä¼˜åŒ–å¡ç‰‡æ¸²æŸ“

#### æ–°å¢åŠŸèƒ½
- `render_item_card()` - ç”¨äºæ¨ªå‘æ»šåŠ¨åˆ—è¡¨
- `render_item_card_inline()` - ç”¨äºç½‘æ ¼å¸ƒå±€
- ç»Ÿä¸€çš„å¡ç‰‡æ ·å¼ï¼š
  - å›¾ç‰‡åŒºåŸŸï¼ˆè‡ªåŠ¨åŠ è½½ï¼‰
  - æ ‡é¢˜æ–‡å­—
  - Hover é«˜äº®æ•ˆæœ
  - ç‚¹å‡»å“åº”

## æŠ€æœ¯æ”¹è¿›

### æ€§èƒ½ä¼˜åŒ–
1. å›¾ç‰‡æ‡’åŠ è½½ - åªåœ¨éœ€è¦æ—¶åŠ è½½
2. åˆ†é¡µæ¸²æŸ“ - å‡å°‘ä¸€æ¬¡æ€§æ¸²æŸ“çš„é¡¹ç›®æ•°
3. å›¾ç‰‡ç¼“å­˜ - é¿å…é‡å¤åŠ è½½

### ç”¨æˆ·ä½“éªŒ
1. æ¸…æ™°çš„å¯¼èˆªç»“æ„ï¼ˆé¢åŒ…å±‘ï¼‰
2. ç›´è§‚çš„åˆ†é¡µæ§åˆ¶
3. ä¸°å¯Œçš„è§†è§‰åé¦ˆï¼ˆHoverã€ç‚¹å‡»ï¼‰
4. å®Œæ•´çš„å½±ç‰‡ä¿¡æ¯å±•ç¤º

### ä»£ç ç»“æ„
1. æ¨¡å—åŒ–çš„æ¸²æŸ“å‡½æ•°
2. ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†
3. æ¸…æ™°çš„äº‹ä»¶å¤„ç†æµç¨‹

## å¾…å®Œå–„åŠŸèƒ½

### å›¾ç‰‡åŠ è½½
å½“å‰ `load_emby_image()` å‡½æ•°æ¡†æ¶å·²å®ç°ï¼Œä½†éœ€è¦ï¼š
1. å®Œå–„å›¾ç‰‡ä¸‹è½½é€»è¾‘
2. æ·»åŠ å›¾ç‰‡è§£ç ï¼ˆä½¿ç”¨ `image` crateï¼‰
3. å°†å›¾ç‰‡æ•°æ®è½¬æ¢ä¸º `TextureHandle`
4. é€šè¿‡äº‹ä»¶ç³»ç»Ÿä¼ å›ä¸»çº¿ç¨‹

å»ºè®®å®ç°ï¼š
```rust
// åœ¨ EmbyEvent ä¸­æ·»åŠ æ–°äº‹ä»¶
pub enum EmbyEvent {
    // ... ç°æœ‰äº‹ä»¶
    ImageLoaded(String, Vec<u8>), // (image_key, image_data)
}

// åœ¨åå°çº¿ç¨‹åŠ è½½å›¾ç‰‡
std::thread::spawn(move || {
    if let Ok(response) = reqwest::blocking::get(&url) {
        if let Ok(bytes) = response.bytes() {
            let _ = tx.send(EmbyEvent::ImageLoaded(image_key, bytes.to_vec()));
        }
    }
});

// åœ¨ä¸»çº¿ç¨‹å¤„ç†
EmbyEvent::ImageLoaded(key, data) => {
    if let Ok(img) = image::load_from_memory(&data) {
        let rgba = img.to_rgba8();
        let size = [img.width() as usize, img.height() as usize];
        let color_image = egui::ColorImage::from_rgba_unmultiplied(size, &rgba);
        let texture = ctx.load_texture(&key, color_image, Default::default());
        self.emby_image_cache.insert(key, texture);
        self.emby_image_loading.remove(&key);
    }
}
```

### Dashboard é¢„è§ˆ
å½“å‰ `render_horizontal_item_row()` æ˜¾ç¤ºå ä½ç¬¦ï¼Œéœ€è¦ï¼š
1. åœ¨åŠ è½½ Dashboard æ—¶é¢„åŠ è½½æ¯ä¸ª View çš„å‰å‡ é¡¹
2. æˆ–è€…å®ç°æŒ‰éœ€åŠ è½½æœºåˆ¶

### å…¶ä»–ä¼˜åŒ–
1. æ·»åŠ åŠ è½½åŠ¨ç”»
2. é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
3. å›¾ç‰‡å°ºå¯¸ä¼˜åŒ–ï¼ˆè¯·æ±‚åˆé€‚çš„åˆ†è¾¨ç‡ï¼‰
4. ç¼“å­˜æŒä¹…åŒ–ï¼ˆä¿å­˜åˆ°ç£ç›˜ï¼‰

## æµ‹è¯•å»ºè®®

1. æµ‹è¯•ä¸åŒæ•°é‡çš„é¡¹ç›®ï¼ˆå°‘äºã€ç­‰äºã€å¤šäºæ¯é¡µæ•°é‡ï¼‰
2. æµ‹è¯•åˆ†é¡µå¯¼èˆªçš„è¾¹ç•Œæƒ…å†µ
3. æµ‹è¯•å›¾ç‰‡åŠ è½½å¤±è´¥çš„æƒ…å†µ
4. æµ‹è¯•ä¸åŒç±»å‹çš„åª’ä½“é¡¹ï¼ˆç”µå½±ã€å‰§é›†ã€æ–‡ä»¶å¤¹ï¼‰
5. æµ‹è¯•å¯¼èˆªæ ˆçš„æ­£ç¡®æ€§ï¼ˆå‰è¿›ã€åé€€ï¼‰

## ä¾èµ–é¡¹

éœ€è¦åœ¨ `Cargo.toml` ä¸­æ·»åŠ ï¼š
```toml
[dependencies]
image = "0.24"  # ç”¨äºå›¾ç‰‡è§£ç 
```
